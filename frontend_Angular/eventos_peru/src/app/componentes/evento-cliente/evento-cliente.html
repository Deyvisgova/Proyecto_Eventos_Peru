<div class="cliente-page">
  <header class="encabezado">
    <div>
      <p class="texto-sutil">Cliente</p>
      <h3>Hola, {{ nombre }}</h3>
      <p class="texto-sutil">Selecciona los servicios para tu {{ tipoEvento }}</p>
    </div>
    <button class="btn-secundario" (click)="cerrarSesion()">Cerrar sesión</button>
  </header>

  <section class="panel-filtros">
    <div class="filtro">
      <p class="texto-sutil">Tipo de evento</p>
      <div class="chips">
        <label class="chip" *ngFor="let e of eventos">
          <input type="radio" name="evento" [value]="e" [(ngModel)]="filtroEvento" (change)="filtrar()" />
          <span>{{ e }}</span>
        </label>
      </div>
    </div>

    <div class="filtro">
      <p class="texto-sutil">Buscar proveedor</p>
      <input
        type="text"
        class="input"
        placeholder="Nombre o empresa"
        [(ngModel)]="filtroProveedor"
        (input)="filtrar()"
      />
    </div>
  </section>

  <section class="panel-proveedores">
    <div class="estado" *ngIf="cargando">Cargando servicios...</div>
    <div class="estado error" *ngIf="!cargando && error">{{ error }}</div>
    <div class="estado" *ngIf="!cargando && !error && !proveedoresFiltrados.length">
      No encontramos servicios para tu búsqueda.
    </div>

    <div class="grid" *ngIf="!cargando && !error">
        <article class="card" *ngFor="let p of proveedoresFiltrados">
          <div class="card-img" [ngStyle]="{ 'background-image': 'url(' + (p.urlFoto || 'assets/servicios/placeholder-servicio.svg') + ')' }">
            <span class="badge">{{ p.catalogoServicio.nombre }}</span>
          </div>
          <div class="card-body">
            <h5>{{ p.nombrePublico }}</h5>
            <p class="texto-sutil">{{ p.descripcionGeneral || 'Servicio sin descripción.' }}</p>
            <div class="proveedor">
              <span class="avatar">{{ (p.proveedor.nombreEmpresa || p.proveedor.nombre || '?').slice(0, 1) }}</span>
              <div>
                <p class="texto-sutil">Proveedor</p>
                <strong>{{ p.proveedor.nombreEmpresa || p.proveedor.nombre }}</strong>
              </div>
            </div>
            <button class="btn-primario" (click)="verServicios(p)">Ver servicios</button>
          </div>
      </article>
    </div>
  </section>

  <div class="modal-backdrop" *ngIf="modalVisible" (click)="cerrarModal()"></div>
  <div class="modal" *ngIf="modalVisible">
    <div class="modal-header">
      <div>
        <p class="texto-sutil">Servicios</p>
        <h4>{{ proveedorSeleccionado?.nombrePublico }}</h4>
      </div>
      <button class="btn-secundario" (click)="cerrarModal()">Cerrar</button>
    </div>

    <div class="modal-body" *ngIf="proveedorSeleccionado">
      <p class="texto-sutil">Selecciona las opciones que necesitas</p>

      <div class="opcion" *ngFor="let o of opciones">
        <label class="opcion-contenido">
          <input type="checkbox" [(ngModel)]="seleccion[o.idOpcion]" />
          <div class="opcion-media" [ngStyle]="{ 'background-image': 'url(' + (o.urlFoto || 'assets/servicios/placeholder-servicio.svg') + ')' }"></div>
          <div class="opcion-texto">
            <div class="opcion-header">
              <h5>{{ o.nombreOpcion }}</h5>
              <span class="precio">S/ {{ o.precio | number: '1.2-2' }}</span>
            </div>
            <p class="texto-sutil">{{ o.descripcion || 'Sin descripción' }}</p>
            <div class="detalle">
              <span *ngIf="o.stock != null">Stock: {{ o.stock }}</span>
              <span *ngIf="o.duracionMinutos">Duración: {{ o.duracionMinutos }} min</span>
            </div>
          </div>
        </label>
      </div>

      <div class="estado" *ngIf="!opciones.length">Este proveedor aún no tiene opciones activas.</div>
    </div>
  </div>
</div>
