<div class="reportes-admin">
  <header class="encabezado">
    <div>
      <p class="eyebrow">Centro de reportes</p>
      <h1>Reportes y descargas</h1>
      <p class="subtitulo">Consulta métricas generales y exporta la información en PDF.</p>
    </div>
    <button class="btn-primario" (click)="generarPdf()" [disabled]="cargando">
      <i class="bi bi-file-earmark-pdf"></i>
      Descargar PDF
    </button>
  </header>

  <section class="filtros">
    <div class="campo">
      <label for="inicio">Fecha inicio</label>
      <input id="inicio" type="date" [(ngModel)]="fechaInicio" (change)="aplicarFiltros()" />
    </div>
    <div class="campo">
      <label for="fin">Fecha fin</label>
      <input id="fin" type="date" [(ngModel)]="fechaFin" (change)="aplicarFiltros()" />
    </div>
    <div class="rango">Rango aplicado: {{ rangoSeleccionado() }}</div>
  </section>

  <section class="resumen" *ngIf="!cargando">
    <div class="card" title="Usuarios registrados">
      <p class="etiqueta">Usuarios</p>
      <p class="valor">{{ resumen.usuarios }}</p>
    </div>
    <div class="card" title="Proveedores activos">
      <p class="etiqueta">Proveedores</p>
      <p class="valor">{{ resumen.proveedores }}</p>
    </div>
    <div class="card" title="Eventos configurados">
      <p class="etiqueta">Eventos</p>
      <p class="valor">{{ resumen.eventos }}</p>
    </div>
    <div class="card" title="Tipos de servicio">
      <p class="etiqueta">Catálogo servicios</p>
      <p class="valor">{{ resumen.catalogo }}</p>
    </div>
    <div class="card" title="Reservas creadas">
      <p class="etiqueta">Reservas</p>
      <p class="valor">{{ resumen.reservas }}</p>
    </div>
  </section>

  <section class="bloque" *ngIf="cargando">
    <p class="cargando">Cargando datos...</p>
  </section>

  <section class="bloque" *ngIf="error">
    <p class="error">{{ error }}</p>
  </section>

  <section class="bloque" *ngIf="!cargando && !error">
    <header class="bloque-header">
      <div>
        <p class="eyebrow">Detalle de reservas</p>
        <h2>Reservas filtradas ({{ reservasFiltradas.length }})</h2>
      </div>
      <span class="pill pill-claro">{{ rangoSeleccionado() }}</span>
    </header>

    <div class="tabla">
      <div class="fila cabecera">
        <span>#</span>
        <span>Cliente</span>
        <span>Proveedor</span>
        <span>Evento</span>
        <span>Fecha</span>
        <span>Estado</span>
      </div>
      <div class="fila" *ngFor="let reserva of reservasFiltradas; let i = index">
        <span>{{ i + 1 }}</span>
        <span>{{ clienteNombre(reserva) }}</span>
        <span>{{ proveedorNombre(reserva) }}</span>
        <span>{{ eventoTitulo(reserva) }}</span>
        <span>{{ fechaLegible(reserva.fechaEvento || reserva.fechaReserva) }}</span>
        <span class="pill" [ngClass]="estadoEtiqueta(reserva.estado)">{{ reserva.estado }}</span>
      </div>
      <div class="fila vacio" *ngIf="reservasFiltradas.length === 0">
        <span class="colspan">No hay reservas en el rango seleccionado.</span>
      </div>
    </div>
  </section>
</div>
