<div class="card">
  <div class="titulo-card">
    <i class="bi bi-calendar-check text-success"></i>
    Reservas del proveedor
  </div>
  <p class="texto-suave">
    Controla tus reservas, revisa el detalle y confirma o rechaza cada solicitud.
  </p>

  <div class="estado" *ngIf="cargando">Cargando reservas...</div>
  <div class="estado error" *ngIf="error">{{ error }}</div>

  <table class="tabla" *ngIf="reservas.length">
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Cliente</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let r of reservas">
        <td>{{ r.fechaEvento | date }}</td>
        <td>{{ r.cliente?.nombre }}</td>
        <td><span [class]="estadoClase(r.estado)">{{ r.estado }}</span></td>
        <td class="acciones">
          <button class="btn-icono" (click)="verDetalle(r)" title="Ver detalle">
            <i class="bi bi-eye"></i>
          </button>
          <button class="btn-accion" (click)="confirmar(r)" [disabled]="r.estado !== 'PENDIENTE'">Confirmar</button>
          <button class="btn-accion rechazo" (click)="rechazar(r)" [disabled]="r.estado === 'CANCELADA'">Rechazar</button>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="estado" *ngIf="!reservas.length && !cargando">No tienes reservas registradas.</div>
</div>

<div class="panel-detalle" *ngIf="seleccionada">
  <div class="panel-header">
    <div>
      <p class="texto-suave">Detalle de reserva</p>
      <h4>{{ seleccionada?.cliente?.nombre }}</h4>
      <p class="texto-suave">Evento: {{ seleccionada?.fechaEvento | date }}</p>
    </div>
    <span [class]="estadoClase(seleccionada.estado)">{{ seleccionada.estado }}</span>
  </div>

  <ul class="detalle-lista" *ngIf="detalles[seleccionada.idReserva]?.length">
    <li *ngFor="let d of detalles[seleccionada.idReserva]">
      <div>
        <strong>{{ d.servicio?.nombreServicio }}</strong>
        <p class="texto-suave">Cantidad: {{ d.cantidad }}</p>
      </div>
      <span>S/ {{ d.precioUnitario | number: '1.2-2' }}</span>
    </li>
  </ul>
</div>
